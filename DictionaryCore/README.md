# 零.引言

- 本伪代码大部分和**SQ系**写法类似。Seiko力求低成本迁移你之前的伪代码  
  同时引入新的变量伪代码等来完善写法。
- 本伪代码模块仍处于初级阶段。如有需求请火速issue

# 一.导入

- 将你的伪代码文件移入`/sdcard/Android/data/com.kagg886.seiko/dic`中
- 前往伪代码页面，下拉刷新

# 二.编写工具

推荐MT管理器，当然其他的随便。萝卜白菜，各有所好

# 三.伪代码的基本格式:(以后会改)

一份Seiko伪代码文档由若干个指令构成，其中一份指令领导着若干伪代码。

## 1.指令

指令由两部分构成:  
`[事件]正则表达式`  
前面的"事件匹配字符串"指的是此指令需要匹配的事件  
而后面的正则表达式则是我们的指令  
你可以使用复合写法，例如按照下面的写法可以同时匹配群和好友命令。  
_不只是只能写两个，后期更新事件时，想追加多少就可以追加多少_  
`[群|好友]早上好`

> 当消息被SeikoDIC接收时，SeikoDIC会先筛选事件类型与其相匹配的词条，然后将消息内容与正则表达式一个一个进行匹配操作。  
> 若以上操作匹配到词条了，则抽出对应的伪代码开始操作  
> 例如:`[群]早上好`可以匹配每一个在群内发送早上好的人  
> **以下是支持的事件列表(以后会补充)**

| 事件匹配字符串 | 详情        | 补充       |
|---------|-----------|----------|
| 群       | 代表一个群消息   | 无        |
| 好友      | 代表一个好友消息  | 无        |
| 函数      | 代表一个词库的函数 | 详见下方调用函数 |

> [你可以在这里找到内建事件匹配的所有字符串和他们对应的Mirai事件](src/main/java/com/kagg886/seiko/dic/entity/DictionaryCommandMatcher.java)

## 2.纯文本

在指令后一定会出现一个纯文本，不然伪代码不会发送任何消息  
直接写入你想发送的消息即可。例如：

```text
[群]早上好
欧尼酱早上好~\n
今天是星期日~
```

如上伪代码被加载后，当群里的一个人发送早上好时，bot将会发送第二行和第三行信息。_(以后详细信息会省略。以此精简文档体积)_
> 我们约定使用\n来作为伪代码的换行符。当此符号出现时，将会换一行再输出。

## 3.变量

变量使用`%变量名%`来访问。在纯文本中，带有%变量名%的字样会被伪代码引擎替换成别的字符。例如:

```text
[群]我的QQ
您的QQ是:%QQ%
```

如上伪代码被**我**加载后发送的是`你的QQ:485184047`  
伪代码执行过程中内置了一些变量。具体得看是这个指令隶属于哪个事件。

### 下表是所有事件都会内置的变量：

| 变量名 | 类型                              | 介绍                                 | 备注                                                                                                   |
|-----|---------------------------------|------------------------------------|------------------------------------------------------------------------------------------------------|
| 上下文 | JavaObject(MessageEvent)        | 获得当前的消息包对象                         | 搭配`$java方法运行$`使用                                                                                     |
| 缓冲区 | JavaObject(MessageChainBuilder) | 准备发送的消息串                           | 搭配`$java方法运行$`使用                                                                                     |
| 时间戳 | 数字                              | 获取伪代码被执行的时间                        | 无                                                                                                    |
| 文本  | 字符串                             | 获取触发伪代码的文本                         | 无                                                                                                    |
| 参数N | 字符串                             | 以空格为分割线，获取分割后字符串列表的元素              | 若%文本%为`主人 早安`，则%参数0%是主人,%主人%是早安                                                                      |
| 参数长 | 数字                              | 获取上面`参数N`的长度                       | 无                                                                                                    |
| 括号N | 字符串                             | 正则表达式若存在括号，则匹配到括号的内容会存放进括号N里，以1开始。 | 若括号被匹配多次，则若想获取第X次匹配的括号内容，写法是:`%括号X_Y%`，X为匹配的类，Y为组别。<br />~~此特性可能会在未来删除，因为我没有找到触发伪代码的指令还能存在多个括号组的对象~~ |
| 括号组 | 数字                              | %括号N%能取到的最大N值                      | 若括号被匹配多次，若想获取第X次匹配出的括号组个数，写法是：`%括号组N%`<br />~~此特性可能会在未来删除，因为我没有找到触发伪代码的指令还能存在多个括号组的对象~~              |

> 为方便理解，现给出括号N的示例：
>
> ```text
> [群]我今年(.*{1,2})岁了，我知道原神的椅子可以(.*)
> %括号1%\n
> %括号2%\n
> 从你的年龄是%括号1%岁可以看出：你是一个若智\n
> 你居然知道原神的椅子可以%括号2%，真的太厉害了！
> ```
>
>

> [你可以在这里找到所有事件都会内置的内建变量](src/main/java/com/kagg886/seiko/dic/session/AbsRuntime.java)

### 下表是群事件内置的变量

| 变量名  | 类型  | 作用                  |                      备注                       |
|------|-----|---------------------|:---------------------------------------------:|
| 群号   | 数字  | 获得发送此消息的群号          |                       无                       |
| 群名称  | 字符串 | 获得发送此消息的群名称         |                       无                       |
| QQ   | 数字  | 获得发送此消息的QQ号         |                       无                       |
| 昵称   | 字符串 | 获得发送此消息的QQ昵称        |                       无                       |
| 群名片  | 字符串 | 获得发送此消息的QQ在这个群里的群名片 |                       无                       |
| BOT  | 数字  | 接收到此消息的bot的QQ号      |                       无                       |
| 特殊头衔 | 字符串 | 获得发送此消息的QQ的特殊头衔     |               若无特殊头衔则和活跃头衔保持一致                |
| 头衔   | 字符串 | 获得发送此消息的QQ的活跃头衔     |                       无                       |
| 权限   | 字符串 | 获得发送此消息的QQ的权限字符串    | OWNER为群主<br/>ADMINISTRATOR为管理员<br/>MEMBER为群成员 |
| 权限代码 | 数字  | 获得发送此消息的QQ的权限字符串    |                   群主＞管理员＞成员                   |
| 艾特N  | 数字  | 获得发送此消息的QQ本次艾特的人的QQ |    若没有的话则此变量不会被替换<br/>实际使用应写成:`艾特0`,`艾特1`     |
| 艾特数  | 数字  | 获得发送此消息的QQ本次艾特的人的个数 |                       无                       |
| 图片N  | 字符串 | 获得发送此消息的QQ本次发送的图片链接 |                   同:**艾特N**                   |
| 图片数  | 数字  | 获得发送此消息的QQ发送的图片张数   |                       无                       |
| 语音链接 | 字符串 | 获得接收到的语音链接          |            匹配指令应写成`[群][语音链接]`(未测试)            |
| 语音秒数 | 数字  | 获得接受到的语音持续时间        |                       无                       |

> [你可以在这里找到群消息的内置变量](src/main/java/com/kagg886/seiko/dic/session/impl/GroupMessageRuntime.java)

### 下表是好友事件内置的变量

| 变量名 | 类型  | 作用             | 备注  |
|-----|-----|----------------|:---:|
| QQ  | 数字  | 获得发送此消息的QQ号    |  无  |
| 昵称  | 字符串 | 获得发送此消息的QQ昵称   |  无  |
| BOT | 数字  | 接收到此消息的bot的QQ号 |  无  |
| 备注  | 字符串 | 获得bot为其设置的备注   |  无  |

> [你可以在这里找到好友消息的内置变量](src/main/java/com/kagg886/seiko/dic/session/impl/FriendMessageRuntime.java)

## 4.计算

SeikoDIC支持算数，但是你要为它们套上方括号**必须是英文半角！**

```text
[群]计算
5+3=[5+3]\n
114+514=[114+514]
```

如上伪代码被加载后，输出结果是`5+3=8...(后略)`  
如果不套方括号，则只会输出`5+3=5+3...(后略)`

## 5.条件表达式

SeikoDIC支持条件表达式，以下伪代码展示了如何使用它：

```text
[群]早上好
早上好鸭~
如果:%QQ%==485184047
今天又是美好的一天呢
返回
如果尾
要不要贴贴——
```

`如果`会匹配它冒号后的表达式，若为true则执行返回前的伪代码。  
若为false则跳转到`如果尾`后，若全文都无如果尾则终止此词条的执行。  
**值得一提的是：在遇到`如果`时，会将此行伪代码前存储的所有字符串全部打包发送。因此在上面的运行结果中，你会看到两条信息**

## 6.函数

Seiko使用`$`包裹字符串的两头来实现函数功能。例如:`$函数 函数参数$`  
但是与Seiko的函数与SQ系伪代码函数略有不同。在学习前请看下面的预备知识：

### 6.1预备知识：

- Seiko的函数分为两类：阻断函数和非阻断函数：  
  所谓阻断函数就是在伪代码引擎调用此函数前会发送在执行此条消息前的所有消息。
  非阻断函数则不会出现此效果。  
  让我们举个例子：在下面的结果中，将会先输出`开始延时了！`，然后等待1秒后输出`延时成功！`和**自己的QQ图片**在一起的图文消息
- 若函数的参数为变量名称(仍需遵守上文提及的变量格式)，则Seiko会将其替换成引用池里的对象而不是字符串(实验性)

```text
[群]延时
开始延时了！
$延时 1000$
延时成功！
$图片 https://q1.qlogo.cn/g?b=qq&nk=485184047&s=640$
```

- Seiko函数不支持嵌套调用

### 6.2函数列表

- **变量类**(操作变量等)

| 名字   | 参数个数 | 调用说明                   | 函数类型  | 说明            | 调用示例         |
|------|------|------------------------|-------|---------------|--------------|
| 变量删除 | 1    | `$变量删除 变量名$`           | 非阻断函数 | 删除变量          | `$变量删除 QQ$`  |
| 变量检验 | 2    | `$变量检验 要存入的变量 要检验的变量$` | 非阻断函数 | 检验变量是否为空      | `$变量检验 A B$` |
| 变量赋值 | 2    | `$变量赋值 变量名 值$`         | 非阻断函数 | 为一个变量赋值       | `$变量赋值 K V$` |
| 变量提取 | 3    | `$变量提取 存入变量 链式表达式$`    | 非阻断函数 | 按照链式表达式的规范获取值 | 详见下方         |

> 对于变量提取中的链式表达式的说明:
>
> 1. 若对集合A(内容是{"key":"abc","tags":[{"id":123456},{"id":789012}]})
     为例，获取tag里的第一个元素的id的链式表达式为`A.tags(0).id`
> 2. 若对集合A(内容是[{"id":123456},{"id":789012}]为例，获取tag里的第一个元素的id的链式表达式为`A(0).id`

- **集合类**(用于对`键值对`进行操作的命令)

| 名字   | 参数个数 | 调用说明                       | 函数类型  | 说明                                   | 调用示例                                                                   |
|------|------|----------------------------|-------|--------------------------------------|------------------------------------------------------------------------|
| 集合创建 | 1    | `$集合创建 变量名$`               | 非阻断函数 | 声明一个集合，可以往集合里放各种数据                   | `$集合创建 A$`                                                             |
| 集合导入 | 2    | `$集合导入 变量名/变量 要转化的字符串$`    | 非阻断函数 | 声明一个集合并赋值，支持XML JSON HTTP头和Cookie表达式 | `$集合导入 A {"a":"b","c":"d","e":114514,"f":true,"g":{"h":"k","m":"n"}}$` |
| 取集合  | 3    | `$取集合 变量名/变量 集合名 键$`       | 非阻断函数 | 获取集合内一个键代表的值                         | `$取集合 A0 A a$`                                                         |
| 集合赋值 | 3    | `$集合赋值 集合名/变量 集合变量 要赋予的值$` | 非阻断函数 | 向一个集合里添加一个键值对。                       | `$集合赋值 A B C$`                                                         |
| 集合长  | 2    | `$集合长 存入变量名 集合名/集合变量$`     | 非阻断函数 | 获取一个集合的长度                            | `$集合长 A B$`                                                            |
| 集合删除 | 2    | `$集合删除 集合名/集合变量 集合变量$`     | 非阻断函数 | 删除集合中的一个数据，以键为索引                     | `$集合删除 A B$`                                                           |

- **数组类**(用于对`数组`操作的命令)

| 名字   | 参数个数 | 调用说明                           | 函数类型  | 说明                                       | 调用示例                             |
|------|------|--------------------------------|-------|------------------------------------------|----------------------------------|
| 数组创建 | 1    | `$数组创建 数组名$`                   | 非阻断函数 | 创建一个数组                                   | `$数组创建 A$`                       |
| 数组导入 | 2    | `$数组导入 存入变量名 数组字符串(json格式)$`   | 非阻断函数 | 将一个字符串转成数组(写死的字符串支持空格)                   | `$数组导入 A [1,2,3,4,5]$`           |
| 数组删除 | 2    | `$数组删除 数组名/数组变量 序号$`           | 非阻断函数 | 删除数组对应序号的内容                              | `$数组删除 A 0$`<br />`$数组删除 %A% 0$` |
| 数组赋值 | 3或2  | `$数组赋值 数组名/数组变量 添加的变量 序号(可选)$` | 非阻断函数 | 若序号存在，则将对应序号的内容替换为新内容。<br />若序号不存在则在末尾追加 | `$数组赋值 A A$`<br />`$数组赋值 A A 2$` |
| 取数组  | 3    | `$取数组 数组名/数组变量 序号 存入变量$`       | 非阻断函数 | 获取数组对应序号的内容。<br />类型可能为字符串，数字，集合或数组      | `$取数组 A 1 B$`                    |
| 数组长  | 2    | `$数组长 数组名/数组变量 存入变量$`          | 非阻断函数 | 获取数组的长度                                  | `$数组长 A B$`                      |
| 数组转  | 2    | `$数组转 数组名/数组变量 存入变量$`          | 非阻断函数 | 将数组转成json字符串                             | `$数组转 A B$`                      |

- **文件类**(持久化存储/读取变量)

| 名字  | 参数个数 | 调用说明                            | 函数类型  | 说明                             | 调用示例                                          |
|-----|------|---------------------------------|-------|--------------------------------|-----------------------------------------------|
| 读   | 4或3  | `$读 变量名 文件 键 值$` `$读 变量名 文件 键$` | 非阻断函数 | 读取文件，然后读取键。若键不存在则返回值(值那里可以不用写) | `$读 A sss.txt key value$` `$读 A sss.txt key$` |
| 写   | 3    | `$写 文件 键 值$`                    | 非阻断函数 | 写入键值对到文件中                      | `$写 A sss.txt key$`                           |

- **字符串类**(提供快捷操作字符串的快捷方法)

| 名字   | 参数个数 | 调用说明                               | 函数类型  | 说明                               | 调用示例                                             |
|------|------|------------------------------------|-------|----------------------------------|--------------------------------------------------|
| 文字替换 | 4或3  | `$文字替换 变量名 被替换文字 替换成文字 存入变量(可选)$`  | 非阻断函数 | 将`变量内的`被替换文字`替换成`替换成文字`          | `$文字替换 A 114 514$`<br />`$文字替换 A 114 514 B$`(下略) |
| 文字分割 | 3或2  | `$文字分割 待分割变量名 分割符号 存入变量(可选)$`      | 非阻断函数 | 将`待分割变量名`按照`分割符号`分割成集合对象         | `$文字分割 A t$`                                     |
| 文字查索 | 3或2  | `$文字查索 待查询变量名 查询的文字 存入变量(可选)$`     | 非阻断函数 | 获得`待查询变量名中，第一次出现`查询的文字`的下标       | `$文字查索 A 草$`                                     |
| 文字匹配 | 3或2  | `$文字匹配 待匹配变量名 要匹配的正则表达式 存入变量(可选)$` | 非阻断函数 | 将`待匹配变量`与`正则表达式`做匹配，返回true/false | `$文字匹配 K [0-9]+$`                                |
| 文字包含 | 3或2  | `$文字包含 待匹配变量名 文字 存入变量(可选)$`        | 非阻断函数 | 检验`带匹配变量`是否包含`文字`                | `$文字包含 A qwq$`                                   |
| 转大写  | 2或1  | `$转大写 变量名 存入变量(可选)$`               | 非阻断函数 | 将变量中的小写字母转成大写                    | `$转大写 A$`                                        |
| 转小写  | 2或1  | `$转小写 变量名 存入变量(可选)$`               | 非阻断函数 | 将变量中的小写字母转成大写                    | `$转小写 A$`                                        |

> 字符串函数的存入变量是可填参数。若不填写此参数，则操作结果会覆盖掉源

- **消息类**(增强发送的消息，使消息不局限于纯文本)

| 名字  | 参数个数 | 调用说明                                           | 函数类型  | 说明                        | 调用示例                                                                                                                                                                                                                                     |
|-----|------|------------------------------------------------|-------|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 图片  | 1    | `$图片 图片url$`                                   | 非阻断函数 | 向消息链里添加一张图片               | `$图片 https://q1.qlogo.cn/g?b=qq&nk=%QQ%&s=640$`                                                                                                                                                                                          |
| 语音  | 3或2  | `$语音 [群/好友] [群号/好友qq] 语音链接$` `$语音 %上下文% 语音链接$` | 阻断函数  | 发送语音消息，**使用mp3会导致电脑端听不了** | `$语音 %上下文% https://www.text-to-speech.cn/mp3/1193435796_1674957193_0.mp3$` `$语音 群 123456789 https://www.text-to-speech.cn/mp3/1193435796_1674957193_0.mp3$` `$语音 好友 1234 https://www.text-to-speech.cn/mp3/1193435796_1674957193_0.mp3$` |

- **控制类**(控制消息发送的时机等)

| 名字  | 参数个数 | 调用说明                      | 函数类型  | 说明               | 调用示例        |
|-----|------|---------------------------|-------|------------------|-------------|
| 延时  | 1    | `$延时 毫秒数$`                | 阻断函数  | 延时后执行后面的代码，单位为毫秒 | `$延时 1000$` |
| 调用  | 1    | `$调用 方法名 循环次数 循环变量存储变量名$` | 非阻断函数 | 调用词库内定义的词条       | 详见下方        |

> 关于**调用**的写法：
>
> 1. 被调用的词条的事件必须是`[函数]`。
> 2. 进入被调函数后，被调函数可以访问调用者的变量。
> 3. 被调函数执行后默认会发送存储的信息。若禁止这种行为，请在最后一行加`返回`
> 4. 以下是示例1：在这个示例中，会发送两条消息。第一条为`准备调用...`，第二条为`赋值完成`和`返回值:1`
     > 在一起的消息。若去掉`返回`，则会发送三条消息。
>
> ```text
> [群]调用测试
> 准备调用...
> $调用 函数A$
> 返回值:%A%
> 
> [函数]函数A
> $变量赋值 A 1$
> 赋值完成!
> 返回
> ```
>
> 5. 以下是示例2：在这个示例中，自增的循环变量会存入到A中供`方法0`使用，故会发送以下消息：
>
> ```text
> 调用开始
> 0
> 1
> 2
> 调用完成
> ```
>
> ```text
> [群]测试
> 调用开始\n
> $调用 方法0 3 A$
> 调用完成\n
> 
> [函数]方法0
> %A%\n
> 返回
> ```
>
>

- **未分类的其他方法**

| 名字         | 参数个数 | 调用说明                                                     | 函数类型   | 说明                                                         | 调用示例                                                     |
| ------------ | -------- | ------------------------------------------------------------ | ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 随机数       | 2        | `$随机数 变量名 最小值 最大值$`                              | 非阻断函数 | 生成一个随机数并存放到变量名中(左闭右开区间)                 | `$随机数 A 1 3$`                                             |
| JAVA方法运行 | 5或4     | `$JAVA方法运行 存入变量 类名(全限定) 方法名 对象 参数列表$` `$JAVA方法运行 存入变量 类名(全限定) 方法名 对象$` | 非阻断函数 | 使用反射调用java方法，配合上文的JavaObject使用               | `$JAVA方法运行 A net.mamoe.mirai.event.events.GroupMessageEvent getSenderName %上下文%$` `$JAVA方法运行 A java.lang.String contains 114514 4$` |
| 访问         | 5或4或3  | `$访问 结果存入变量 请求方式 网址 头集合/头集合名(可以使用null占位) 参数集合/参数体$` | 阻断函数   | 访问一个网址，并将结果转成字符串存入 头集合和参数集合为可选选项，传入类型为集合 | `访问 GET http://www.baidu.com`                              |